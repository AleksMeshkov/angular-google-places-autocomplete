"use strict";angular.module("google.places",[]).factory("googlePlacesApi",["$window",function(e){if(!e.google)throw"Global `google` var missing. Did you forget to include the places API script?";return e.google}]).directive("gPlacesAutocomplete",["$parse","$compile","$timeout","$document","googlePlacesApi",function(e,t,n,r,i){return{restrict:"A",require:"^ngModel",scope:{model:"=ngModel",options:"=?",forceSelection:"=?",customPlaces:"=?"},controller:["$scope",function(e){}],link:function(e,n,s,o){function c(){n.bind("keydown",d);n.bind("blur",v);n.bind("submit",v);e.$watch("selected",m)}function h(){var n=angular.element("<div g-places-autocomplete-drawer></div>"),i=angular.element(r[0].body),s;n.attr({input:"input",query:"query",predictions:"predictions",active:"active",selected:"selected"});s=t(n)(e);i.append(s)}function p(){o.$parsers.push(g);o.$formatters.push(y);o.$render=b}function d(t){if(e.predictions.length===0||N(a,t.which)===-1){return}t.preventDefault();if(t.which===u.down){e.active=(e.active+1)%e.predictions.length;e.$digest()}else if(t.which===u.up){e.active=(e.active?e.active:e.predictions.length)-1;e.$digest()}else if(t.which===13||t.which===9){if(e.forceSelection){e.active=e.active===-1?0:e.active}e.$apply(function(){e.selected=e.active;if(e.selected===-1){w()}})}else if(t.which===27){t.stopPropagation();w();e.$digest()}}function v(t){if(e.predictions.length===0){return}if(e.forceSelection){e.selected=e.selected===-1?0:e.selected}e.$digest();e.$apply(function(){if(e.selected===-1){w()}})}function m(){var t;t=e.predictions[e.selected];if(!t)return;if(t.is_custom){e.model=t.place;e.$emit("g-places-autocomplete:select",t.place)}else{l.getDetails({placeId:t.place_id},function(t,n){if(n==i.maps.places.PlacesServiceStatus.OK){e.$apply(function(){e.model=t;e.$emit("g-places-autocomplete:select",t)})}})}w()}function g(t){var n;if(!(t&&x(t)))return t;e.query=t;n=angular.extend({input:t},e.options);f.getPlacePredictions(n,function(t,n){e.$apply(function(){var r;w();if(e.customPlaces){r=E(e.query);e.predictions.push.apply(e.predictions,r)}if(n==i.maps.places.PlacesServiceStatus.OK){e.predictions.push.apply(e.predictions,t)}if(e.predictions.length>5){e.predictions.length=5}if(e.predictions.length===0&&e.forceSelection){var s=e.$root.$$phase;var o=function(){e.model=""};if(s=="$apply"||s=="$digest"){o()}else{e.$apply(o)}e.$emit("g-places-autocomplete:empty",true)}})});return t}function y(e){var t="";if(x(e)){t=e}else if(T(e)){t=e.formatted_address}return t}function b(){return n.val(o.$viewValue)}function w(){e.active=-1;e.selected=-1;e.predictions.length=0}function E(t){var n=[],r,i,s;for(s=0;s<e.customPlaces.length;s++){r=e.customPlaces[s];i=S(t,r);if(i.matched_substrings.length>0){n.push({is_custom:true,custom_prediction_label:r.custom_prediction_label||"(Custom Non-Google Result)",description:r.formatted_address,place:r,matched_substrings:i.matched_substrings,terms:i.terms})}}return n}function S(e,t){var n=e+"",r=[],i=[],s,o,u;o=t.formatted_address.split(",");for(u=0;u<o.length;u++){s=o[u].trim();if(n.length>0){if(s.length>=n.length){if(C(s,n)){i.push({length:n.length,offset:u})}n=""}else{if(C(n,s)){i.push({length:s.length,offset:u});n=n.replace(s,"").trim()}else{n=""}}}r.push({value:s,offset:t.formatted_address.indexOf(s)})}return{matched_substrings:i,terms:r}}function x(e){return Object.prototype.toString.call(e)=="[object String]"}function T(e){return Object.prototype.toString.call(e)=="[object Object]"}function N(e,t){var n,r;if(e==null)return-1;r=e.length;for(n=0;n<r;n++){if(e[n]===t)return n}return-1}function C(e,t){return k(e).lastIndexOf(k(t),0)===0}function k(e){return e==null?"":e.toLowerCase()}var u={tab:9,enter:13,esc:27,up:38,down:40},a=[u.tab,u.enter,u.esc,u.up,u.down],f=new i.maps.places.AutocompleteService,l=new i.maps.places.PlacesService(n[0]);(function(){e.query="";e.predictions=[];e.input=n;e.options=e.options||{};h();c();p()})()}}}]).directive("gPlacesAutocompleteDrawer",["$window","$document",function(e,t){var n=['<div class="pac-container" ng-if="isOpen()" ng-style="{top: position.top+\'px\', left: position.left+\'px\', width: position.width+\'px\'}" style="display: block;" role="listbox" aria-hidden="{{!isOpen()}}">','  <div class="pac-item" g-places-autocomplete-prediction index="$index" prediction="prediction" query="query"','       ng-repeat="prediction in predictions track by $index" ng-class="{\'pac-item-selected\': isActive($index) }"','       ng-mouseenter="selectActive($index)" ng-click="selectPrediction($index)" role="option" id="{{prediction.id}}">',"  </div>","</div>"];return{restrict:"A",scope:{input:"=",query:"=",predictions:"=",active:"=",selected:"="},template:n.join(""),link:function(n,r){function i(n){var r=n[0],i=r.getBoundingClientRect(),s=t[0].documentElement,o=t[0].body,u=e.pageYOffset||s.scrollTop||o.scrollTop,a=e.pageXOffset||s.scrollLeft||o.scrollLeft;return{width:i.width,height:i.height,top:i.top+i.height+u,left:i.left+a}}r.bind("mousedown",function(e){e.preventDefault()});n.isOpen=function(){return n.predictions.length>0};n.isActive=function(e){return n.active===e};n.selectActive=function(e){n.active=e};n.selectPrediction=function(e){n.selected=e};n.$watch("predictions",function(){n.position=i(n.input)},true)}}}]).directive("gPlacesAutocompletePrediction",[function(){var e=['<span class="pac-icon pac-icon-marker"></span>','<span class="pac-item-query" ng-bind-html="prediction | highlightMatched"></span>','<span ng-repeat="term in prediction.terms | unmatchedTermsOnly:prediction">{{term.value | trailingComma:!$last}}&nbsp;</span>','<span class="custom-prediction-label" ng-if="prediction.is_custom">&nbsp;{{prediction.custom_prediction_label}}</span>'];return{restrict:"A",scope:{index:"=",prediction:"=",query:"="},template:e.join("")}}]).filter("highlightMatched",["$sce",function(e){return function(t){var n="",r="",i;if(t.matched_substrings.length>0&&t.terms.length>0){i=t.matched_substrings[0];n=t.terms[0].value.substr(i.offset,i.length);r=t.terms[0].value.substr(i.offset+i.length)}return e.trustAsHtml('<span class="pac-matched">'+n+"</span>"+r)}}]).filter("unmatchedTermsOnly",[function(){return function(e,t){var n,r,i=[];for(n=0;n<e.length;n++){r=e[n];if(t.matched_substrings.length>0&&r.offset>t.matched_substrings[0].length){i.push(r)}}return i}}]).filter("trailingComma",[function(){return function(e,t){return t?e+",":e}}])